<table width="100%">
  <% form_for :donation, @donation, :url => {:action => 'done', :donation_id => @donation.id} do |f| -%>
    <%= f.error_messages %>
  <% @donation.donation_line_items.each_with_index do |dli, index| -%>
    <tr>
        <td align="right"><%= dli.description %>
        </td>
        <td align="left"><%= dli.amount.format(:html) %>
        </td>
    </tr>
  <% end -%>
    <tr>
        <td align="right">total
        </td>
        <td align="left"><%= @donation.amount.format(:html) %>
        </td>
    </tr>
    <tr>
        <td><!--%= submit_tag 'Continue' %--></td>
        <td></td>
    </tr>
    <% end -%>
    <tr>
        <td>
            <% payment_service_for @donation.id, PAYPAL_ACCOUNT,
                              :amount => @donation.amount,
                              :currency => 'USD',
                              :service => :paypal,
                              :html => { :id => 'payment-form' } do |service| %>
                   <% service.invoice @donation.id %>
                   <% service.shipping '0.00' %>
                   <% service.tax '0.00' %>
               <% @donation.donation_line_items.each_with_index do |dli, index| -%>
                   <input type="hidden" name="item_number_<%= index %>" value="<%= dli.account.id %>"/>
                   <input type="hidden" name="item_name_<%= index %>" value="<%= dli.description %>"/>
                   <input type="hidden" name="amount_<%= index %>" value="<%= dli.amount %>"/>
               <% end -%>
                   <% service.notify_url url_for(:only_path => false, :action => 'notify') %>
                   <% service.return_url url_for(:only_path => false, :action => 'done') %>
                   <% service.cancel_return_url 'http://www.savetogether.org/' %>
                   <%= submit_tag "Donate" %>
             <% end %>
        </td>
    </tr>
</table>
